apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: frr-master-singlestack-configmap-template
objects:
- kind: ConfigMap
  apiVersion: v1
  data:
   daemons: |+
     # This file tells the frr package which daemons to start.
     #
     # Sample configurations for these daemons can be found in
     # /usr/share/doc/frr/examples/.
     #
     # ATTENTION:
     #
     # When activating a daemon for the first time, a config file, even if it is
     # empty, has to be present *and* be owned by the user and group "frr", else
     # the daemon will not be started by /etc/init.d/frr. The permissions should
     # be u=rw,g=r,o=.
     # When using "vtysh" such a config file is also needed. It should be owned by
     # group "frrvty" and set to ug=rw,o= though. Check /etc/pam.d/frr, too.
     #
     # The watchfrr, zebra and staticd daemons are always started.
     #
     bgpd=${BGPD_ENABLED}
     ospfd=no
     ospf6d=no
     ripd=no
     ripngd=no
     isisd=no
     pimd=no
     ldpd=no
     nhrpd=no
     eigrpd=no
     babeld=no
     sharpd=no
     pbrd=no
     bfdd=${BFDD_ENABLED}
     fabricd=no
     vrrpd=no
     pathd=no
     #
     # If this option is set the /etc/init.d/frr script automatically loads
     # the config via "vtysh -b" when the servers are started.
     # Check /etc/pam.d/frr if you intend to use "vtysh"!
     #
     vtysh_enable=yes
     zebra_options="  -A 127.0.0.1 -s 90000000"
     bgpd_options="   -A 127.0.0.1"
     ospfd_options="  -A 127.0.0.1"
     ospf6d_options=" -A ::1"
     ripd_options="   -A 127.0.0.1"
     ripngd_options=" -A ::1"
     isisd_options="  -A 127.0.0.1"
     pimd_options="   -A 127.0.0.1"
     ldpd_options="   -A 127.0.0.1"
     nhrpd_options="  -A 127.0.0.1"
     eigrpd_options=" -A 127.0.0.1"
     babeld_options=" -A 127.0.0.1"
     sharpd_options=" -A 127.0.0.1"
     pbrd_options="   -A 127.0.0.1"
     staticd_options="-A 127.0.0.1"
     bfdd_options="   -A 127.0.0.1"
     fabricd_options="-A 127.0.0.1"
     vrrpd_options="  -A 127.0.0.1"
     pathd_options="  -A 127.0.0.1"
     # configuration profile
     #
     #frr_profile="traditional"
     #frr_profile="datacenter"
     #
     # This is the maximum number of FD's that will be available.
     # Upon startup this is read by the control files and ulimit
     # is called.  Uncomment and use a reasonable value for your
     # setup if you are expecting a large number of peers in
     # say BGP.
     MAX_FDS=1024
     # The list of daemons to watch is automatically generated by the init script.
     #watchfrr_options=""
     # To make watchfrr create/join the specified netns, use the following option:
     #watchfrr_options="--netns"
     # This only has an effect in /etc/frr/<somename>/daemons, and you need to
     # start FRR with "/usr/lib/frr/frrinit.sh start <somename>".
     # for debugging purposes, you can specify a "wrap" command to start instead
     # of starting the daemon directly, e.g. to use valgrind on ospfd:
     #   ospfd_wrap="/usr/bin/valgrind"
     # or you can use "all_wrap" for all daemons, e.g. to use perf record:
     #   all_wrap="/usr/bin/perf record --call-graph -"
     # the normal daemon command is added to this at the end.

   frr.conf: |
      !
      frr defaults traditional
      hostname frr-router
      log file /tmp/frr.log debugging
      log timestamp precision 3
      !
      debug bgp neighbor-events
      debug bgp nht
      debug bgp updates in
      debug bgp updates out
      debug bfd peer
      !
      router bgp 64500
      ${ROUTER_IP}
      no bgp ebgp-requires-policy
      no bgp default ipv4-unicast
      no bgp network import-check
      neighbor ${NODE1_IP} remote-as 64500
      neighbor ${NODE1_IP} password ${PASSWORD}
      neighbor ${NODE2_IP} remote-as 64500
      neighbor ${NODE2_IP} password ${PASSWORD}
      neighbor ${NODE3_IP} remote-as 64500
      neighbor ${NODE3_IP} password ${PASSWORD}
      neighbor ${NODE4_IP} remote-as 64500
      neighbor ${NODE4_IP} password ${PASSWORD}
      neighbor ${NODE5_IP} remote-as 64500
      neighbor ${NODE5_IP} password ${PASSWORD}
      !
      address-family ipv4 unicast
        neighbor ${NODE1_IP} activate
        neighbor ${NODE1_IP} bfd profile ${BFD_PROFILE}
        neighbor ${NODE2_IP} activate
        neighbor ${NODE2_IP} bfd profile ${BFD_PROFILE}
        neighbor ${NODE3_IP} activate
        neighbor ${NODE3_IP} bfd profile ${BFD_PROFILE}
        neighbor ${NODE4_IP} activate
        neighbor ${NODE4_IP} bfd profile ${BFD_PROFILE}
        neighbor ${NODE5_IP} activate
        neighbor ${NODE5_IP} bfd profile ${BFD_PROFILE}
      exit-address-family
      !
      route-map RMAP permit 10
      set ipv6 next-hop prefer-global 
      !
      ipv6 nht resolve-via-default
      !
      line vty
      !
      end

   vtysh.conf: ""
  metadata:
   name: "${NAME}"
   namespace: "${NAMESPACE}"
parameters:
- name: BGPD_ENABLED
- name: BFDD_ENABLED
- name: ROUTER_IP
- name: NODE1_IP
- name: NODE2_IP
- name: NODE3_IP
- name: NODE4_IP
- name: NODE5_IP
- name: BFD_PROFILE
- name: NAME
- name: NAMESPACE
- name: PASSWORD
